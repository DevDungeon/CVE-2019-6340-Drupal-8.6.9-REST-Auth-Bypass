# Tested on Drupal 8.6.9 with all 4 web services modules turned on: HAL, HTTP Basic Auth, REST, Serialization
# https://www.ambionics.io/blog/drupal8-rce
import requests
import json

host = 'http://127.0.0.1:8000'


url = host + '/node/1' # this must be a node that exists to get the message that indicates it's processing even w/o auth
headers = {
  'Content-Type': 'application/hal+json',
  'Cache-Control': 'no-cache',
  'Accept': 'application/hal+json',
}
query = {
  '_format': 'hal_json',
}
data = {
  '_links': {'type': {'href': host + '/rest/type/node/asdfadfasdf'}},  # this node type must not exist to get the 'does not correspond' message
  'type': [{'target_id': 'article'}],
  'body': [{'value': 'Test body.'}],
  'title':[{'value': 'Test title'}],
}
response = requests.get(url, # works even with get
                         params=query,
                         data=json.dumps(data).encode('utf-8'),
                         #auth=auth,  # No auth provided!
                         headers=headers)
print(response.status_code)
print(response.text)
